# Auth Gateway

This is a Proxy between the Browser Client (React), OAuth2 Provider (Hydra) and Identity Provider (Kratos).

## How it works

1. Client starts the flow by opening the OAuth2 Provider (Hydra) login/registration link.
2. Hydra redirects the user to the Browser Client with a `login_challenge` in the URL.
3. Browser Client authenticates with Identity Provider via Auth Gateway.
4. Auth Gateway accepts the login challenge in OAuth2 Provider.
5. OAuth2 Provider returns a redirect to consent page with a `consent_challenge` in the URL.
6. Browser Client shows the consent page.
7. User consents to the scopes and Auth Gateway accepts the consent challenge in OAuth2 Provider.
8. Browser Client redirects to the "redirect_uri" with the authorization code in the URL.
9. Client uses code to exchange for tokens and saves them in the local storage.

## Structure

Structure of the project is as follows:

```plaintext
/
├── cmd/
│   └── proxy/             # entry-point app
│       └── main.go
├── internal/              # private application code
│   ├── server/            # HTTP server bootstrap
│   │   ├── router.go
│   │   └── middleware/
│   │       ├── logging.go
│   │       ├── recovery.go
│   │       └── cors.go
│   ├── proxy/             # Kratos + Hydra HTTP client & helpers
│   │   ├── kratos.go
│   │   ├── hydra.go
│   │   └── transport.go
│   └── config/            # typed configuration structs + loader
│       └── config.go
├── pkg/                   # public libraries (if you ever export any)
├── api/                   # OpenAPI + examples (generated & hand-edited)
│   ├── docs.go            # ← generated by `swag init`
│   ├── swagger.json
│   └── swagger.yaml
├── scripts/
│   └── gen-swagger.sh
├── .env.example
├── Makefile
└── go.mod

```

## PACKAGES

1. Router - `github.com/julienschmidt/httprouter`
2. Swagger - `github.com/swaggo/swag`, `github.com/swaggo/http-swagger/v2`
3. Observability - `go.opentelemetry.io/otel`, `github.com/prometheus/client_golang/prometheus`, `go.uber.org/zap`
4. Environment - `github.com/caarlos0/env/v10`
5. Dev Quality of Life - `github.com/cosmtrek/air`
